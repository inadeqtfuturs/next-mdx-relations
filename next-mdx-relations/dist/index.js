import{promises as t}from'fs';import r from'gray-matter';import{serialize as e}from'next-mdx-remote/serialize';import n from'path';import a from'fast-glob';function o(t){return 0===Object.keys(t).length&&t.constructor===Object}function s(t,r){let e=r;if(('string'==typeof r||r instanceof String)&&(e=r.split('.')),!Array.isArray(e))throw new Error('Please provide a path to `getValueFromPath`');return e.reduce(((t,r)=>t&&t[r]?t[r]:null),t)}function i(t={},r=[]){return Array.isArray(t)||Object(t)!==t?{objectPath:r,value:t}:Object.entries(t).flatMap((([t,e])=>i(e,[...r,t])))}function c(t){return t.replace(' ','-')}async function u(t,r){const e=r||t.content,o=(null==t?void 0:t.slugRewrites)||null,s=n.join(process.cwd(),e),i=await a.sync(`${s}/**/*.(md|mdx)`);return i?i.map((t=>{const r=t.replace(new RegExp(`${n.extname(t)}$`),'').replace(`${s}/`,'').split('/');return o&&o[r[0]]&&(r[0]=o[r[0]]),{filePath:t,params:{slug:r}}})):[]}async function f(t,r){const e=r||t.content;return(await u(t,e)).map((({params:t})=>({params:t})))}function m(t,{meta:r,frontmatter:e}){const n=i({meta:r,frontmatter:e});if(!Array.isArray(n))return t;return t.filter((t=>n.reduce(((r,{objectPath:e,value:n})=>{const a=s(t,e);return Array.isArray(a)&&Array.isArray(n)?n.every((t=>a.includes(t)))&&r:Array.isArray(a)&&'string'==typeof n?a.includes(n)&&r:'string'==typeof a&&Array.isArray(n)?n.includes(a)&&r:'boolean'==typeof n?n===a&&r:a===n&&r}),!0)))}async function l(e,{meta:n={},frontmatter:a={}}={}){const i=await u(e);if(!i.length)return[];const{metaGenerators:c,relationGenerators:f,sort:l}=e;return await Promise.all(i.map((async e=>{const n=await async function(e){const n=await t.readFile(e.filePath),{content:a,data:o}=r(n);return{...e,content:a,frontmatter:o}}(e),a=await async function(t,r=null){if(r)return Object.entries(r).reduce(((r,[e,n])=>({...r,[e]:n(t)})),{})}(n,c);return a?{...n,meta:a}:n}))).then((async t=>{const r=function(t,r){if(!r)return t;const{by:e,order:n}=r,a=t.sort(((t,r)=>s(r,e)-s(t,e)));return'asc'===n?a.reverse():a}(await async function(t,r=null){return r?Object.values(r).reduce(((t,r)=>r(t)),t):t}(t,f),l);if(!o(n)||!o(a)){return m(r,{meta:n,frontmatter:a})}return r}))}async function y(t,r){const n=(await l(t)).find((t=>JSON.stringify(t.params.slug)===JSON.stringify(r)));if(!n)return null;const{frontmatter:a,content:o}=n,{mdxOptions:s}=t,i=await e(o,{scope:a,mdxOptions:{...s}});return{...n,mdx:i}}async function p(t,r){const e=(await l(t,{})).reduce(((t,e)=>{const n=s(e,r);if(!n)return t;if(Array.isArray(n)){const r=n.map((t=>c(t)));return[...t,...r]}const a=c(n);return[...t,a]}),[]);return[...new Set(e)]}function d(t){return{getPaths:r=>f(t,r),getPathsByProp:r=>p(t,r),getPages:({meta:r,frontmatter:e}={})=>l(t,{meta:r,frontmatter:e}),getPageProps:r=>y(t,r)}}export default d;export{y as getPageProps,l as getPages,f as getPaths,p as getPathsByProp};
